# pvfUtility MCP服务器 - 使用说明

## 🎯 概述
这是一个为 pvfUtility 软件创建的 MCP (Model Context Protocol) 服务器，允许通过标准化接口访问 pvfUtility 的所有 WebApi 功能。

## 📋 系统要求
- Python 3.10 或更高版本
- uv 包管理器（推荐）或 pip
- pvfUtility 软件（需要开启 WebApi 服务）

## 🚀 快速开始

### 1. 安装依赖
```bash
# 使用安装脚本（推荐）
install.bat

# 或手动安装
uv sync
```

### 2. 测试服务器
```bash
# 使用 uv 测试
test_uv.bat

# 或直接运行
uv run test_mcp_server.py
```

### 3. 配置 MCP 客户端
您的 MCP 配置已经设置为：
```json
{
  "pvfutility": {
    "command": "uv",
    "args": [
      "--directory",
      "C:\\Users\\sen\\Downloads\\pvfUtilityWebApi-master",
      "run",
      "mcp_server.py",
      "--base-url",
      "http://localhost:27000"
    ],
    "env": {}
  }
}
```

## 📁 文件说明

### 核心文件
- `mcp_server.py` - MCP 服务器主文件
- `pyproject.toml` - uv 项目配置文件
- `requirements.txt` - Python 依赖列表

### 配置文件
- `mcp_config.json` - MCP 客户端配置示例
- `update_mcp_config.py` - 自动更新系统 MCP 配置的脚本

### 工具脚本
- `install.bat` - 依赖安装脚本
- `start_mcp.bat` - 启动 MCP 服务器
- `test_uv.bat` - 使用 uv 运行测试
- `test_mcp_server.py` - 功能测试脚本

### 文档
- `README_MCP.md` - 详细技术文档（英文）
- `使用说明.md` - 本文件（中文）

## 🔧 可用的 MCP 工具

服务器提供了 25 个 MCP 工具函数，涵盖：

### 基础信息
- `get_version` - 获取 pvfUtility 版本
- `get_pvf_root_directory` - 获取 PVF 根目录
- `get_pvf_pack_file_path` - 获取已加载的 PVF 包文件路径

### 文件操作
- `get_file_list` - 获取文件列表
- `get_file_content` - 获取文件内容
- `get_file_content_json` - 获取文件内容（JSON格式）
- `delete_file` - 删除文件
- `import_file` - 导入文件
- `file_exists` - 检查文件是否存在
- `folder_exists` - 检查文件夹是否存在

### 批量操作
- `get_batch_file_content` - 批量获取文件内容
- `delete_batch_files` - 批量删除文件
- `import_batch_files` - 批量导入文件

### 搜索和 LST
- `search_pvf` - 搜索 PVF 文件
- `get_all_lst_file_list` - 获取所有 LST 文件列表
- `get_lst_file_info` - 获取 LST 文件信息

### 其他功能
- `get_item_info` - 获取物品信息
- `get_file_icon` - 获取文件图标
- `save_as_pvf` - 保存为 PVF 文件
- `get_string_table` - 获取字符串表数据

## ⚠️ 注意事项

1. **确保 pvfUtility 运行**：使用前必须启动 pvfUtility 软件并开启 WebApi 服务
2. **端口配置**：默认使用端口 27000，如需修改请更新配置
3. **Python 版本**：需要 Python 3.10+ 以支持 MCP 包
4. **编码问题**：批处理文件使用 GB2312 编码以避免中文乱码

## 🐛 故障排除

### 连接失败
- 检查 pvfUtility 是否正在运行
- 确认 WebApi 服务已开启
- 验证端口 27000 是否可用

### 依赖安装失败
- 确保网络连接正常
- 尝试使用 pip 而不是 uv
- 检查 Python 版本是否 >= 3.10

### MCP 客户端无法连接
- 重启 MCP 客户端
- 检查配置文件路径是否正确
- 验证 uv 是否已安装

## 📞 支持

如有问题，请检查：
1. 所有依赖是否正确安装
2. pvfUtility 软件是否正常运行
3. 配置文件是否正确设置

---

🎉 现在您可以在支持 MCP 的应用中使用 pvfUtility 的所有功能了！